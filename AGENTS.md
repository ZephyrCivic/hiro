# AGENTS.md

## Motto / 方針
- 変更は「小さく・明確で・安全なステップ」で進めること。
- 必ず実在するドキュメントやデータを根拠にし、不明点があればそのまま進めず質問や TODO を残すこと。

## Project overview
- このディレクトリは「GTFS可視化・配布時刻表スタジオ」のアイデア／PoC 用ワークスペース（moc）です。
- このワークスペースの成果物は GitHub リポジトリ `https://github.com/ZephyrCivic/hiro.git` にプッシュし、静的 Web サイトとして Web アプリケーションを提供する（例: GitHub Pages 等の静的ホスティング）。
- 現時点では、主にコンセプトの `readme.md` とサンプル GTFS データ（`gtfs/`）が置かれています。
- 将来的なアプリケーション実装の技術スタックは README の「技術スタック（案）」をベースに、利用者と相談して決定すること。ビルド／デプロイ手順を追加する場合は、本ファイルの「Setup / build / test」節に必ず追記すること。

## Directories
- `readme.md`: プロダクトの UX / 機能概要・コンセプトの一次ソース。実装方針を考える前に必ず読むこと。
- `gtfs/`: 作業用に取得した GTFS ZIP アーカイブ群。乗り継ぎ評価や可視化ロジックの検証に用いる。
 - `Plans.md`: このプロジェクトにおける計画とタスク管理のマスタ。作業開始前・完了時に必ず更新すること。

## Planning / Plans.md
- すべての開発・資料作成タスクは、原則として `Plans.md` に Markdown のチェックボックス形式（`- [ ]` / `- [x]`）で記述し、このファイルを計画の単一の情報源（single source of truth）とする。
- 新しい作業を始める前に、`Plans.md` を開いて対象タスクを選択し、必要に応じてタスクをより小さなステップに分割してから実装・編集に着手すること。
- タスクが完了したら、必ず `Plans.md` の該当するチェックボックスを `[ ]` から `[x]` に変更し、必要であれば簡単なメモ（実行したコマンド、関連ファイル、PR/コミット ID など）を追記すること。
- `Plans.md` に記載がない作業を行う必要が生じた場合は、その場で `Plans.md` にタスクを追加してから手を動かすこと（「作業ログ」と「実作業」が乖離しないようにする）。
- タスク管理ツール（Issue トラッカー等）を別途利用する場合でも、このリポジトリ内では `Plans.md` を最優先の計画マスタとして扱い、AGENTS.md から参照する指示内容と矛盾させないこと。

## Setup / build / test
- 現時点でビルドや自動テスト対象のアプリケーションコードは存在しない。
- 新しくコード（スクリプト・ライブラリ・アプリ）を追加する場合は、以下をこの節に追記してから作業を進めること。
  - 依存関係のインストール方法（例: `python -m venv .venv && .venv\\Scripts\\activate` / `pip install -r requirements.txt`）
  - 静的チェック・単体テスト・E2E テストなど、タスクに必要なコマンド
- PoC 用の軽量な解析スクリプトを追加する場合でも、最低限 `README` か本ファイルに「どう実行し、どう検証するか」を 1 行以上で説明すること。
- Web アプリ実装を追加し、`https://github.com/ZephyrCivic/hiro.git` にプッシュする場合は、「静的サイトとしてビルドするコマンド」と「デプロイ前に実行すべき最小限のテストコマンド（例: Lint・単体テスト）」をここに明記すること。

## GitHub / deploy rules
- ソースコードおよび生成物の正本は GitHub リポジトリ `https://github.com/ZephyrCivic/hiro.git` で管理すること（ローカル作業ディレクトリはこのリポジトリへ同期される前提）。
- Web アプリケーションは静的 Web サイトとしてホストされることを前提とし、サーバーサイド専用の機能（常時稼働が必要な API サーバーや DB 直結の管理画面など）はこのリポジトリには含めない。必要な場合は別リポジトリや別コンポーネントとして分離し、本ファイルからリンクすること。
- GitHub Pages などの静的ホスティングにデプロイする具体的な手順（例: ビルドコマンド、出力ディレクトリ、デプロイ用スクリプト）が決まり次第、そのコマンド列を「Setup / build / test」節に追記し、デプロイ前に必ず実行すること。

## Technology stack（このリポジトリ）
- この `hiro` リポジトリで実装する Web アプリケーションは、フロントエンドを中心とした静的 Web アプリとする。
- フロントエンドは README の「技術スタック（案）」に従い、TypeScript + React を前提とし、地図表示には Leaflet または MapLibre を用いる。
- 静的ホスティング（GitHub Pages 等）を前提とするため、フロントエンドのビルドには静的サイトとして出力可能なツールチェーン（例: Vite, Next.js の静的エクスポートなど）を利用すること。具体的なツールを導入したら、対応するビルドコマンドを「Setup / build / test」節に追記する。
- README に記載されているバックエンド（Python / Node.js）およびデータベース（PostgreSQL＋PostGIS）は、中長期的な分析基盤・バッチ処理などの候補スタックとして扱い、このリポジトリにはサーバーサイド常駐プロセスや DB そのものは直接含めない。必要になった場合は別リポジトリまたはバッチジョブとして設計し、その関係を README かドキュメントに明示すること。

## Coding conventions
- コメント・コミットメッセージ・新規ドキュメントは日本語で記述してよい（利用者が希望する場合を除き、無理に英語化しない）。
- 新規コードを書く場合は、小さなスクリプト／Notebook 単位で始め、大きなフレームワーク導入（Web アプリケーション、DB 連携など）は必ず利用者に相談してから行うこと。
- GTFS 処理ロジックは「標準 GTFS 仕様」を前提とするが、事業者ごとの例外処理が必要だと判断した場合は、必ずコメントと簡単な説明ドキュメントを併記すること。

## GTFS data handling
- `gtfs/` 配下の ZIP は、`agency.txt` を含む標準的な GTFS フィードであることを前提に扱う。
- 新規に GTFS ZIP を保存する場合は、次の命名規則を推奨する。
  - `YYYYMMDD_事業者名.zip`（例: `20251201_広島電鉄・府中町.zip`）
  - 事業者名は `agency.txt` の `agency_name` を連結して用いる。
- GTFS ZIP の中身（テキストファイル）を書き換える場合は、元データを必ず別名でバックアップし、加工用データと生データをディレクトリ単位で分けること（例: `gtfs/raw/`, `gtfs/processed/`）。
- 公開されている GTFS であっても、外部サービスへのアップロードや第三者共有を行う前に、利用者に意図と公開範囲を確認すること。

## Requirements / product definition
- 機能・UX の要件は、当面 `readme.md` の記述を一次ソースとする。
- 新しい機能案や要件を整理する場合は、`docs/requirements/` のようなディレクトリを作成し、AGENTS.md から参照する形に拡張していくこと。
- 実装を伴うタスクでは、着手前に README の該当節を読み、どのユーザーストーリーに対応するかをコメントまたは PR 説明に明記すること。

## Guardrails
- 推測や捏造は行わない。仕様・要件・データの前提に不明点がある場合は、`TODO: 要確認` などのプレースホルダと、利用者への具体的な質問案を残してから先に進むこと。
- 速度より正確さを優先する。曖昧なまま大きな変更を加えず、小さなステップで検証しながら進めること。
- ディレクトリ削除・一括リネーム・大量のファイル生成など破壊的な操作を行う前に、必ず目的と影響範囲をコメントし、可能なら一覧コマンドで対象を確認してから実行すること。
- API キーやパスワードなどの秘密情報を新たにファイルへ書き込まない。必要な場合は環境変数やローカル設定ファイルに退避し、AGENTS.md には扱い方のみ記載すること。

## Interaction rules for Codex / agents
- このプロジェクトに関するチャット応答は日本語で行うこと。
- コードやデータに変更を加える場合は、意味と構文をできる限り自動・手動の両方で検証すること（シンタックスエラーや明らかなロジック矛盾を残さない）。
- ツール（シェルコマンド・スクリプト）の呼び出し回数に制約はなく、検証や探索のために小さなコマンドを頻繁に実行してよい。
- 不確実性が残る状態でタスクを完了とせず、「ここまで確定」「ここから先は要確認」と明確に分けて報告すること。

## Quick checklist
- Plan: 大きな変更の前に、短い計画（ステップ）を共有する。
- Read: 関連しそうなファイル・ドキュメントを一通り読んでから編集を始める。
- Verify: 外部仕様や前提は可能な限り一次資料（仕様書・README・データ）で確認する。
- Implement: 変更範囲を小さく保ち、1 ステップごとに意味と構文を見直す。
- Test + Docs: 可能な範囲で動作確認とドキュメント更新を行い、何を確認したかを残す。
- Reflect: 問題の根本原因を意識し、同種の不具合が再発しないように周辺も軽く点検する。
