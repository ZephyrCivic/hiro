# （仮）GTFS可視化・配布時刻表スタジオ README

> 「ダイヤ改正の 2〜3 ヶ月、
> “この画面なしでは仕事したくない” を目指すツール」

---

## 1. ユーザー体験（UXストーリー）※この章がプロダクトの骨子

### 1-1. ダイヤ改正プロジェクトの最初の1日

> **登場人物：広電のダイヤ計画担当・Aさん**

1. Aさんは、春のダイヤ改正プロジェクトのキックオフで
   「今年は JR やコミバスとの乗り継ぎをもう少し良くしよう」と言われる。
2. デスクに戻り、ブラウザで
   **「GTFS可視化・配布時刻表スタジオ」**を開く。
3. 画面上部で

   * 改正ラベル：`2026年春ダイヤ改正`
   * 対象エリア：`〇〇地区（広電＋JR＋コミバス）`
     を選択し、「プロジェクトを開始」ボタンをクリック。
4. 地図と停留所一覧が表示され、
   任意の停留所をクリックすると、

   * **自社（広電）＋他社（JR・コミバス）の全便の時刻表**が
     時間順に1つのリストとして表示される。
5. フィルタで

   * 「広電だけ」
   * 「JR＋広電」
   * 「すべての事業者」
     を切り替えながら、**直感的に“乗り継ぎの良し悪し”を確認**できる。

→ Aさんは「まずはいつも混む〇〇停留所から見ていこう」と決め、
他社便を眺めながら、新しい自社便の候補案を頭の中で描き始める。

---

### 1-2. 乗り継ぎ性の評価で「ヤバい箇所」が一目でわかる

1. 画面上部の「乗り継ぎ評価」タブを開くと、

   * 主要な乗り継ぎ停留所の **待ち時間ヒストグラム**
   * 「平均待ち時間」「20分以上待ちが発生する本数」などの
     指標が、自動で計算されて表示される。
2. Aさんは「〇〇停留所（広電→JR）」をクリック。

   * 「20〜30分待たされるケースが多い」ことが赤いバーで強調されている。
3. 「このケースを減らす」を押すと、

   * JR の発車時刻に対して
     **“広電を何分ずらすと待ち時間が10分以内に収まるか”** の候補が
     サジェストされる（※最終判断は人間がする）。
4. Aさんは、その候補を基に、
   社内のダイヤ作成システム側で検討する“当たり”の案を整理できる。

→ 「勘と経験だけに頼る」のではなく、
**“どの乗り継ぎが特に厳しいか”を可視化しながらダイヤ検討できる**体験。

---

### 1-3. 公開GTFS＋手動入力で「地域全体」を1画面に

1. エリア内には、GTFSが公開されていない小さなコミュニティバスもある。
2. その場合、ツール上で

   * 「GTFS未公開事業者を追加」ボタンを押し、
   * ExcelやPDFから読み取った時刻を**手動で入力**することで、
     疑似的な“ローカルGTFS”を作成できる。
3. 一度作った擬似データは、プロジェクト内で再利用され、
   次回の改正時には修正点だけを直せばよい。

→ **「GTFSがあるところは自動で」「ないところは最低限の手作業で」**
　地域全体を1つの時刻表空間として扱える。

---

### 1-4. 検討が終わったら「配付時刻表をワンクリックで」

1. ダイヤ案が固まりつつあるタイミングで、
   Aさんは画面右上の **「配付時刻表を生成」ボタン**を押す。
2. 出てくるダイアログで、

   * 出力対象：`〇〇地区・A停留所〜C停留所`
   * フォーマット：

     * `停留所掲示用 A4縦 3段`
     * `地域パンフレット用 A3横 2面`
       を選択。
3. プレビュー画面では、

   * 高齢者でも読みやすいフォントサイズ
   * 「広電」「JR」「コミバス」が色分けされた時刻表
     が表示される。
4. 「PDF出力」をクリックすると、

   * 印刷会社や社内配付に回せる形の**最終版に近いレイアウト**がダウンロードされる。

→ Aさんは「これまで Excel で地獄のコピペをしていた作業」を
　ほぼ自動で済ませることができる。

---

### 1-5. ダイヤ改正期間（2〜3ヶ月）を通じての使われ方

* 改正プロジェクトの期間中、

  * Aさんは**ほぼ毎日、このツールを立ち上げる。**
  * 「他社を含む現状の見える化」と
    「新ダイヤ案の乗り継ぎ評価」と
    「最終的な配付時刻表生成」まで、
    **一連のプロセスをこのツールの上で完結**させる。
* 結果として、

  * 「他社時刻表を紙や別タブで見ながら…」という**ムダな往復**が減り、
  * 「どの乗り継ぎが本当に問題か」を定量的に説明できるようになる。

→ この UX が、このプロダクトの **“コア体験”** です。

---

## 2. プロダクト概要

**プロダクト名（仮）：GTFS可視化・配布時刻表スタジオ**

* 複数事業者の GTFS（＋手動入力）を取り込み、
  ダイヤ計画担当のための

  * **他社ダイヤ可視化**
  * **乗り継ぎ評価**
  * **配付時刻表自動生成**
    を行う業務支援ツールです。

* 特徴：

  * 「計画担当の 2〜3 ヶ月」を支える**プロジェクトインフラ**であること
  * 年 1 回のイベントでも、その期間中は**毎日使う“仕事の画面”**になること

---

## 3. 想定ユーザー

* バス・鉄道事業者の

  * ダイヤ計画担当
  * 企画・計画部門
* 自治体・地域公共交通コーディネーター（閲覧・分析用）
* 交通系コンサルタント（分析・報告書作成用）

---

## 4. 主な機能

### 4-1. GTFS & ローカル時刻データ統合

* 公開されている GTFS フィードを読み込み、

  * 停留所
  * 系統・路線
  * 便（trip）
  * カレンダー
    を自動で取り込む。
* GTFSが存在しない事業者については、

  * CSV / Excel / 手入力ベースで「簡易GTFS」を作成できる UIを提供。
* GTFS＋簡易GTFSをまとめて「地域時刻表空間」として扱う。

### 4-2. 停留所単位の時刻表統合表示

* 任意の停留所を選ぶと、

  * 自社＋他社の全便が**時間順に1つのテーブル**で表示。
* 絞り込み条件：

  * 事業者別（自社のみ／他社のみ／全社）
  * 曜日・運行日（平日／土休日／特定日）
  * 上り／下り

### 4-3. 乗り継ぎ性評価（簡易アナリティクス）

* 指定した停留所ペア（例：広電→JR）について、

  * 乗り継ぎ待ち時間の分布
  * 待ち時間 xx 分以上のケース数
  * 便ごとの乗り継ぎマッチング一覧
    を自動算出。
* 「待ち時間 xx 分以内を満たすための、自社便時刻の調整幅候補」を計算（※最終判断は人）。

### 4-4. 配付時刻表自動生成

* 出力対象を選択：

  * 停留所単位
  * エリア単位（複数停留所をまとめたパンフレット形式）
* テンプレート選択：

  * 停留所掲示用 A4 縦・横
  * パンフレット用 A3 など
* PDF生成（印刷所／社内配布にそのまま渡せるレベル）
  ※レイアウトエンジンはテンプレートでカスタマイズ可能

### 4-5. プロジェクト管理

* 「2026春ダイヤ」「2027春ダイヤ」など改正単位でプロジェクトを作成。
* プロジェクトごとに

  * 使用したデータセット（GTFSバージョン）
  * 各停留所の乗り継ぎ評価結果
  * 出力した配付時刻表の履歴
    を保存・再利用。

---

## 5. データ要件

* 入力：

  * GTFS フィード（複数事業者）
  * 簡易 GTFS（CSV/Excel/手入力から生成）
* 出力：

  * 内部DB（PostgreSQL等）に正規化して保存
  * 配付時刻表 PDF / HTML
  * 乗り継ぎ評価レポート（CSV / PDF）

---

## 6. 技術スタック（案）

* フロントエンド：

  * TypeScript + React
  * 地図表示：Leaflet or MapLibre
* バックエンド：

  * Python / Node.js
  * GTFSパーサー・集計ロジック
* データベース：

  * PostgreSQL（＋PostGIS）
* インフラ：

  * クラウド（AWS / GCP など）、コンテナデプロイを想定

※ README 時点ではあくまで案。PoC で決定。

---

## 7. 導入メリット（ユーザー目線）

* 他社含めた時刻表を**1画面で見ながらダイヤ検討**できる
* 「乗り継ぎが悪い区間」が**感覚ではなく数値で分かる**
* 配付時刻表を**Excel職人の作業に頼らず**に作成できる
* GTFSが公開されていない事業者も、最低限の手入力で巻き込める
* ダイヤ改正の 2〜3 ヶ月間、計画担当にとっての**“ホーム画面”**になり得る

---

## 8. 今後の拡張アイデア（メモ）

* ダイヤ作成システムとの API 連携（案のインポート／エクスポート）
* 将来的な B 案（連携フロー可視化）の一部取り込み
  → GTFS 公開日時や各バージョンの履歴表示
* 住民向け Web 時刻表（軽量版）の自動ホスティング
* 乗り継ぎ評価ロジックの高度化（遅延データの組み込み等）

---
