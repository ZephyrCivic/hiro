# フェーズ2 要件: 任意バス停の配布時刻表作成

## 目的
- フェーズ1で実装した「停留所単位の統合時刻表」をもとに、配布・掲示に耐える「配布時刻表」を自動生成する。
- ダイヤ計画担当が、Excel 等での手作業を減らし、ほぼそのまま印刷・配布できる PDF / 印刷レイアウトを得られるようにする。

## 入力と前提
- フェーズ1で実装済みの機能を前提とする。
  - 任意停留所の統合時刻表が Web アプリ上で取得できること。
  - 事業者区分（広電／その他）が付与されていること。
- 出力対象は当面「1 停留所単位」の配布時刻表とし、エリア単位（複数停留所をまとめたパンフレット）は将来拡張とする。

## 機能要件

### 1. 配布時刻表プレビュー画面
- 任意のバス停を選択し、「配布時刻表プレビュー」を表示できる UI を用意する。
  - 地図上の停留所詳細パネルに「配布時刻表プレビュー」ボタンを追加する、などの導線を想定。
- プレビュー画面では、印刷時のレイアウトをほぼそのまま再現する。

### 2. レイアウト要件（暫定案）
- 対象フォーマット:
  - 第一段階では「停留所掲示用 A4 縦・片面 1 面」を標準とする。
  - A3 や複数面レイアウトは将来的な拡張とし、本フェーズでは扱わない。
- 表示内容:
  - 停留所名
  - 対象となる曜日・運行日（例: 平日ダイヤ）
  - 広電とその他事業者の時刻を区別した表
    - 色分け、もしくは記号・列分けなどで視覚的に識別可能にする。
  - 必要に応じて注記欄（運行日注意書きなど）。
- フォント・可読性:
  - 高齢者でも読みやすいフォントサイズを前提とする。
  - 初期案として、見出し（停留所名など）はおおよそ 12pt 前後、時刻表の本文（時刻など）は 10pt 程度を目安とし、それ未満にならないレイアウトを目指す。
  - 実際の印刷結果を確認しながら、フォントサイズや行間は調整する。

### 2-1. 暫定レイアウト詳細（v0 案）
- ページ仕様: A4 縦・片面。印刷用 CSS で `@page { size: A4 portrait; margin: 15mm; }` を指定し、余白は上下左右 12?15mm を目安に確保する。
- 構成ブロック:
  1. ヘッダ: 停留所名（太字 13?14pt）、改正ラベル／対象ダイヤ（平日など）、データ版数・出力日（9pt 程度）。
  2. 凡例・注記: 事業者色の凡例（広電／その他）、運行日注意書きや備考を 9?10pt でまとめる。
  3. 時刻表本体: 時刻順テーブル（4 列想定: 発時刻 / 事業者 / 系統・路線 / 行き先）。必要に応じて時間帯ごとの小見出し（例: 6時台, 7時台）を入れ、行間は 1.2?1.3 程度で詰めすぎない。
- フォント目安: 見出し 13?14pt、テーブル本文 10pt、注記 9pt。行間は本文で 1.2?1.3、見出しは 1.1 程度。
- 色分け（暫定）: 広電行は背景を淡い緑（例: `#e0f2f1`）＋文字は濃緑（例: `#0f766e`）、その他事業者行は淡いグレー（例: `#e2e8f0`）＋文字は濃紺グレー（例: `#334155`）。印刷可読性を優先し、コントラスト比が低くならないようにする。
- テーブル見出し: 背景を薄グレーで統一し、列幅は「発時刻」を最小幅、「事業者」「系統」を中幅、「行き先」を残り幅で可変にする。
- 印刷考慮: ブラウザ印刷で背景色を出す場合に備えて、色分けがない状態でも判別できるよう `【広電】` などのラベルを併記する。ページあふれを防ぐため縦方向スクロールではなく 1 ページ内に収めることを優先し、行数が多い場合は次ページに繰り返しヘッダを表示する設計とする（CSS `thead { display: table-header-group; }` 想定）。

### 3. 広電／その他の表現
- フェーズ1と同様の判断ロジックを用いて、「広電」と「その他事業者」を識別する。
- レイアウト上での表現方法（例）:
  - 行ごとの背景色を変える。
  - 事業者名を記号や略称（例: 【広電】）として付与する。
  - 列を分ける（左: 広電、右: その他） など。
- 実際にどの表現が現場で読みやすいかは、サンプル出力を使って利用者と調整する。

### 4. 印刷／PDF 出力
- 最低限、ブラウザの「印刷」機能で A4 に収まるよう、印刷用 CSS を整える。
- 可能であれば、ブラウザから PDF として保存した結果でもレイアウトが崩れないことを確認する。
- TODO: 将来的にサーバーレスの PDF 生成（ライブラリ利用）を行うかどうかを検討する。

## UI 要件（最小）
- PC ブラウザでの利用を主ターゲットとする。
- プレビュー画面では以下を満たす。
  - 紙面に近い比率での表示（A4 縦を意識した縦長レイアウト）。
  - ページ単位の余白（マージン）を確保し、切れないようにする。
- UI コンポーネントは `shadcn/ui` をベースとし、ボタン、タブ、テーブル、ダイアログ等のコンポーネントを用いて一貫した見た目と操作感を実現する。
- 画面上のラベル・ボタン・メニューなどは日本語表記とし、バス計画担当者が業務の文脈で理解しやすい用語（例: 「停留所」「配布時刻表プレビュー」「印刷」など）を使用する。

## 非機能要件（フェーズ2時点）
- 実行時間:
  - 1 停留所の配布時刻表プレビュー生成は、体感で 1?2 秒程度以内を目標とする。
- メンテナンス性:
  - レイアウトの調整（列の追加・削除、色の変更など）が CSS レベルで完結するよう、HTML 構造をシンプルに保つ。

## TODO / 要確認事項
- 実際に運用する用紙サイズ・面数（A4 縦・片面を標準としつつ、他サイズに拡張するか）の最終確認。
- 印刷環境（プリンタ・出力解像度）に応じたフォントサイズ・行間の微調整。
- 表示する情報量（当面は全便を載せる想定だが、将来的に時間帯で絞り込むオプションを追加するか）の方針。
- 将来的にエリア単位のパンフレット（複数停留所）出力をどのフェーズで扱うか。
